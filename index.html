<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ficha Clínica — Sistema Completo</title>
<!-- Dependências via CDN: jsPDF e html2canvas (para gerar PDFs com imagens) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
:root{--brand:#0ea5a4;--muted:#666}
*{box-sizing:border-box}
body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;margin:0;background:#f6f7fb;color:#111}
.header{background:linear-gradient(90deg,var(--brand),#7dd3fc);color:#fff;padding:14px 18px;display:flex;align-items:center;justify-content:space-between}
.header h1{margin:0;font-size:18px}
.container{max-width:1100px;margin:18px auto;padding:12px}
.grid{display:grid;grid-template-columns:320px 1fr;gap:12px}
.card{background:#fff;border-radius:10px;padding:12px;box-shadow:0 8px 24px rgba(17,24,39,0.06)}
.controls{display:flex;gap:8px;align-items:center}
.input,button,select,textarea{padding:8px;border-radius:8px;border:1px solid #e6e6f2}
.button{background:var(--brand);color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
.small{font-size:13px;color:var(--muted)}
.client-list{max-height:520px;overflow:auto;margin-top:8px}
.client-item{padding:8px;border-radius:8px;border:1px solid #f0eef8;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center}
.form-row{display:flex;gap:8px;align-items:center;margin-bottom:8px}
.form-row .col{flex:1}
.photo-preview{width:80px;height:80px;border-radius:8px;object-fit:cover;border:1px solid #eee}
.signature{border:1px solid #ddd;border-radius:6px}
.note{font-size:13px;color:var(--muted);margin-top:8px}
@media(max-width:900px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<header class="header">
  <h1>Ficha Clínica / Estética — Sistema (Offline)</h1>
  <div class="controls">
    <button class="button" id="btnBackup">Exportar JSON</button>
    <button class="button" id="btnImport">Importar JSON</button>
    <button class="button" id="btnPDFAll">Exportar PDF (Ficha)</button>
  </div>
</header>
<main class="container">
  <div class="grid">
    <aside class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong>Clientes</strong>
        <div style="display:flex;gap:6px">
          <input id="searchClient" class="input" placeholder="Pesquisar..." />
          <button id="btnNewClient" class="button">+ Cliente</button>
        </div>
      </div>
      <div class="client-list" id="clientList"></div>
      <div style="margin-top:10px;display:flex;gap:8px">
        <button id="btnClearLocal" class="input">Limpar dados</button>
        <button id="btnPin" class="input">Ativar PIN</button>
      </div>
      <div class="note">Dados salvos no navegador (localStorage). Use Exportar para backup.</div>
    </aside>

    <section class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div>
          <strong>Ficha / Procedimentos</strong>
          <div class="small">Crie ficha, registre procedimentos, fotos e termo assinado no celular.</div>
        </div>
        <div class="kv">
          <select id="selectClient" class="input"></select>
          <button id="btnNewProcedure" class="button">+ Procedimento</button>
        </div>
      </div>

      <div id="procedureArea"></div>

    </section>
  </div>
</main>

<!-- modal container -->
<div id="modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.45);align-items:center;justify-content:center;z-index:99;padding:20px">
  <div style="background:#fff;padding:14px;border-radius:12px;max-width:720px;width:100%;max-height:90vh;overflow:auto">
    <div id="modalContent"></div>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
      <button id="modalCancel" class="input">Cancelar</button>
      <button id="modalSave" class="button">Salvar</button>
    </div>
  </div>
</div>

<script>
/* FICHA CLÍNICA - Sistema completo (localStorage) 
   - Clientes CRUD
   - Procedimentos por cliente
   - Fotos (base64 local)
   - Assinatura com canvas
   - Exportar PDF da ficha
   - Import / Export JSON
   - PIN simples para bloquear
*/
const STORAGE_KEY='ficha_clinica_v1';
let DB={clients:[]};
const $=id=>document.getElementById(id);
function uid(p='id'){return p+Math.random().toString(36).slice(2,9)}
function save(){localStorage.setItem(STORAGE_KEY, JSON.stringify(DB));}
function load(){const s=localStorage.getItem(STORAGE_KEY);DB=s?JSON.parse(s):{clients:[]};}

function todayStr(d=new Date()){const y=d.getFullYear();const m=String(d.getMonth()+1).padStart(2,'0');const day=String(d.getDate()).padStart(2,'0');return y+'-'+m+'-'+day}

// render clients list & select
function renderClients(filter=''){
  const listEl=$('clientList'); listEl.innerHTML='';
  const clients = DB.clients.filter(c=> (c.name||'').toLowerCase().includes(filter.toLowerCase()));
  clients.forEach(c=>{
    const div=document.createElement('div'); div.className='client-item';
    const left=document.createElement('div'); left.style.display='flex'; left.style.gap='8px'; left.style.alignItems='center';
    const img=document.createElement('img'); img.src=c.photo||''; img.alt='foto'; img.className='photo-preview'; if(!c.photo) img.style.display='none';
    const info=document.createElement('div'); info.innerHTML=`<div style=\"font-weight:600\">${c.name}</div><div class='small'>${c.phone||''}</div>`;
    left.appendChild(img); left.appendChild(info);
    const right=document.createElement('div'); right.innerHTML=`<div style=\"display:flex;gap:6px\"><button class=\"input\" data-id=\"${c.id}\" data-action=\"open\">Abrir</button><button class=\"input\" data-id=\"${c.id}\" data-action=\"export\">JSON</button><button class=\"input\" data-id=\"${c.id}\" data-action=\"del\">Apagar</button></div>`;
    div.appendChild(left); div.appendChild(right); listEl.appendChild(div);
  });
  // select
  const sel=$('selectClient'); sel.innerHTML='<option value="">-- Selecionar cliente --</option>' + DB.clients.map(c=>`<option value="${c.id}">${c.name}</option>`).join('');
}

// open client modal (create/edit)
async function openClientModal(id=null){
  const client = id?DB.clients.find(x=>x.id===id):{id:null,name:'',phone:'',birth:'',notes:'',photo:null,procedures:[]};
  const html=`<h3>Ficha do Cliente</h3>
    <div class="form-row"><div class="col"><label>Nome</label><input id=\"m_name\" class=\"input\" value=\"${escapeHtml(client.name||'')}\" /></div></div>
    <div class="form-row"><div class="col"><label>Telefone</label><input id=\"m_phone\" class=\"input\" value=\"${escapeHtml(client.phone||'')}\" /></div><div class="col"><label>Data de nascimento</label><input id=\"m_birth\" type=\"date\" class=\"input\" value=\"${client.birth||''}\" /></div></div>
    <div><label>Contraindicações / Observações</label><textarea id=\"m_notes\" class=\"input\" style=\"width:100%\">${escapeHtml(client.notes||'')}</textarea></div>
    <div style=\"margin-top:8px\"><label>Foto do cliente (opcional)</label><input id=\"m_photo\" type=\"file\" accept=\"image/*\" /></div>
    <div style=\"margin-top:8px;display:flex;gap:8px;align-items:center\"><img id=\"m_preview\" class=\"photo-preview\" src=\"${client.photo||''}\" ${client.photo?'':'style=\\"display:none\\"'} /></div>`;
  const res = await openModal(html, async ()=>{
    const name=$('m_name').value.trim(); if(!name) return alert('Nome obrigatório');
    const phone=$('m_phone').value.trim(); const birth=$('m_birth').value; const notes=$('m_notes').value.trim();
    // handle photo
    const file=$('m_photo').files[0]; let photo=client.photo||null;
    if(file){ photo = await fileToBase64(file); }
    if(client.id){ // update
      client.name=name; client.phone=phone; client.birth=birth; client.notes=notes; client.photo=photo; const idx=DB.clients.findIndex(x=>x.id===client.id); DB.clients[idx]=client;
    } else { const newc={id:uid('c_'),name,phone,birth,notes,photo,procedures:[]}; DB.clients.push(newc);} save(); renderClients($('searchClient').value||'');
  });
}

// open procedure modal
async function openProcedureModal(clientId, procId=null){
  const client = DB.clients.find(x=>x.id===clientId); if(!client) return alert('Cliente não encontrado');
  const proc = procId?client.procedures.find(p=>p.id===procId):{id:null,date:todayStr(),procedure:'',professional:'',products:'',notes:'',before:null,after:null,signature:null};
  const html=`<h3>Procedimento - ${escapeHtml(client.name)}</h3>
    <div class=\"form-row\"><div class=\"col\"><label>Data</label><input id=\"p_date\" type=\"date\" class=\"input\" value=\"${proc.date}\"/></div><div class=\"col\"><label>Procedimento</label><input id=\"p_name\" class=\"input\" value=\"${escapeHtml(proc.procedure||'')}\"/></div></div>
    <div class=\"form-row\"><div class=\"col\"><label>Profissional</label><input id=\"p_prof\" class=\"input\" value=\"${escapeHtml(proc.professional||'')}\"/></div><div class=\"col\"><label>Produtos usados</label><input id=\"p_prod\" class=\"input\" value=\"${escapeHtml(proc.products||'')}\"/></div></div>
    <div><label>Observações</label><textarea id=\"p_notes\" class=\"input\" style=\"width:100%\">${escapeHtml(proc.notes||'')}</textarea></div>
    <div style=\"display:flex;gap:10px;margin-top:8px;align-items:center\">    
      <div>
        <label>Foto Antes</label><input id=\"p_before\" type=\"file\" accept=\"image/*\" />
        <div><img id=\"preview_before\" class=\"photo-preview\" src=\"${proc.before||''}\" ${proc.before?'':'style=\\"display:none\\"'} /></div>
      </div>
      <div>
        <label>Foto Depois</label><input id=\"p_after\" type=\"file\" accept=\"image/*\" />
        <div><img id=\"preview_after\" class=\"photo-preview\" src=\"${proc.after||''}\" ${proc.after?'':'style=\\"display:none\\"'} /></div>
      </div>
    </div>
    <div style=\"margin-top:8px\"><label>Assinatura (cliente)</label><div><canvas id=\"sig_canvas\" width=\"500\" height=\"150\" class=\"signature\"></canvas></div><div style=\"display:flex;gap:8px;margin-top:6px\"><button id=\"sig_clear\" class=\"input\">Limpar</button><button id=\"sig_save\" class=\"input\">Salvar assinatura</button></div></div>`;

  const res = await openModal(html, async ()=>{
    const date=$('p_date').value; const name=$('p_name').value.trim(); const prof=$('p_prof').value.trim(); const prod=$('p_prod').value.trim(); const notes=$('p_notes').value.trim();
    if(!date||!name) return alert('Data e procedimento são obrigatórios');
    // handle images
    const fBefore=$('p_before').files[0]; const fAfter=$('p_after').files[0]; let before=proc.before||null; let after=proc.after||null;
    if(fBefore) before=await fileToBase64(fBefore);
    if(fAfter) after=await fileToBase64(fAfter);
    // signature (if saved into hidden input)
    const sigData = window._temp_signature || proc.signature || null; delete window._temp_signature;
    if(proc.id){ proc.date=date; proc.procedure=name; proc.professional=prof; proc.products=prod; proc.notes=notes; proc.before=before; proc.after=after; proc.signature=sigData; const idx=client.procedures.findIndex(p=>p.id===proc.id); client.procedures[idx]=proc; }
    else { const newp={id:uid('p_'),date,procedure:name,professional:prof,products:prod,notes,before,after,signature:sigData}; client.procedures.push(newp); }
    save(); renderClients($('searchClient').value||''); renderProcedureArea(client.id);
  });

  // after modal opened: setup signature canvas listeners and preview handlers
  setTimeout(()=>{
    const canvas=$('sig_canvas'); const ctx=canvas.getContext('2d'); ctx.lineWidth=2; ctx.lineCap='round'; let drawing=false; function pos(e){const r=canvas.getBoundingClientRect(); if(e.touches){return {x:e.touches[0].clientX-r.left,y:e.touches[0].clientY-r.top}} return {x:e.clientX-r.left,y:e.clientY-r.top}}
    canvas.onpointerdown=(e)=>{drawing=true; const p=pos(e); ctx.beginPath(); ctx.moveTo(p.x,p.y)};
    canvas.onpointermove=(e)=>{ if(!drawing) return; const p=pos(e); ctx.lineTo(p.x,p.y); ctx.stroke(); };
    canvas.onpointerup=()=>{drawing=false}; canvas.onpointerleave=()=>{drawing=false};
    $('sig_clear').onclick=()=>{ ctx.clearRect(0,0,canvas.width,canvas.height); }
    $('sig_save').onclick=()=>{ const data=canvas.toDataURL('image/png'); window._temp_signature = data; alert('Assinatura capturada'); }
    // previews for images
    $('p_before').onchange=async function(){ const f=this.files[0]; if(!f) return; const b=await fileToBase64(f); $('preview_before').src=b; $('preview_before').style.display='block'; }
    $('p_after').onchange=async function(){ const f=this.files[0]; if(!f) return; const b=await fileToBase64(f); $('preview_after').src=b; $('preview_after').style.display='block'; }
    // if existing signature, draw it to canvas
    if(proc.signature){ const img=new Image(); img.onload=()=>{ ctx.drawImage(img,0,0,canvas.width,canvas.height); }; img.src=proc.signature; }
  },100);
}

// render procedure area for selected client
function renderProcedureArea(clientId){ const area=$('procedureArea'); area.innerHTML=''; if(!clientId) return; const client=DB.clients.find(c=>c.id===clientId); if(!client) return; 
  const header=document.createElement('div'); header.style.display='flex'; header.style.justifyContent='space-between'; header.style.alignItems='center'; header.innerHTML=`<div><strong>Ficha: ${escapeHtml(client.name)}</strong><div class=\"small\">(${client.phone||''})</div></div><div style=\"display:flex;gap:8px\"><button id=\"btnExportClient\" class=\"input\">Exportar JSON</button><button id=\"btnPDFClient\" class=\"input\">Exportar PDF</button></div>`; area.appendChild(header);
  const notes=document.createElement('div'); notes.style.marginTop='8px'; notes.innerHTML=`<div class=\"card\"><strong>Observações</strong><div class=\"small\">${escapeHtml(client.notes||'')}</div></div>`; area.appendChild(notes);
  const procs=document.createElement('div'); procs.style.marginTop='10px'; procs.innerHTML=`<strong>Procedimentos</strong>`;
  if(!client.procedures || !client.procedures.length){ const none=document.createElement('div'); none.className='small'; none.textContent='Nenhum procedimento registrado.'; procs.appendChild(none); }
  else { client.procedures.slice().sort((a,b)=>a.date>b.date? -1:1).forEach(p=>{
    const item=document.createElement('div'); item.className='card'; item.style.marginTop='8px'; item.innerHTML=`<div style=\"display:flex;justify-content:space-between;align-items:center\"><div><strong>${escapeHtml(p.procedure)}</strong><div class=\"small\">${p.date} — ${p.professional||''}</div></div><div style=\"display:flex;gap:8px\"><button class=\"input\" data-cid=\"${client.id}\" data-pid=\"${p.id}\" data-action=\"view\">Ver</button><button class=\"input\" data-cid=\"${client.id}\" data-pid=\"${p.id}\" data-action=\"edit\">Editar</button><button class=\"input\" data-cid=\"${client.id}\" data-pid=\"${p.id}\" data-action=\"del\">Apagar</button></div></div>`;
    procs.appendChild(item);
  }) }
  area.appendChild(procs);
  // attach handlers
  setTimeout(()=>{
    $('btnExportClient').onclick=()=>downloadClientJSON(client.id);
    $('btnPDFClient').onclick=()=>exportClientPDF(client.id);
    procs.querySelectorAll('button').forEach(b=>{ b.onclick=(e)=>{ const act=b.dataset.action; const cid=b.dataset.cid; const pid=b.dataset.pid; if(act==='view') viewProcedure(cid,pid); if(act==='edit') openProcedureModal(cid,pid); if(act==='del'){ if(confirm('Apagar procedimento?')){ const cl=DB.clients.find(x=>x.id===cid); cl.procedures=cl.procedures.filter(x=>x.id!==pid); save(); renderProcedureArea(cid); } } } });
  },50);
}

function viewProcedure(cid,pid){ const client=DB.clients.find(x=>x.id===cid); const p=client.procedures.find(x=>x.id===pid); let html=`<h3>${escapeHtml(p.procedure)}</h3><div><strong>Data:</strong> ${p.date}</div><div><strong>Profissional:</strong> ${escapeHtml(p.professional||'')}</div><div style=\"margin-top:8px\"><strong>Produtos:</strong><div class=\"small\">${escapeHtml(p.products||'')}</div></div><div style=\"margin-top:8px\"><strong>Observações:</strong><div class=\"small\">${escapeHtml(p.notes||'')}</div></div>`;
  if(p.before) html+=`<div style=\"margin-top:8px\"><strong>Antes</strong><div><img src=\"${p.before}\" class=\"photo-preview\"></div></div>`;
  if(p.after) html+=`<div style=\"margin-top:8px\"><strong>Depois</strong><div><img src=\"${p.after}\" class=\"photo-preview\"></div></div>`;
  if(p.signature) html+=`<div style=\"margin-top:8px\"><strong>Assinatura</strong><div><img src=\"${p.signature}\" style=\"max-width:100%;border:1px solid #eee;border-radius:8px\"></div></div>`;
  openInfoModal(html);
}

// export/import
function downloadJSON(){ const blob=new Blob([JSON.stringify(DB,null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='ficha_clinica_backup.json'; a.click(); URL.revokeObjectURL(url); }
function downloadClientJSON(id){ const client=DB.clients.find(x=>x.id===id); if(!client) return; const out=JSON.stringify(client,null,2); const blob=new Blob([out],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=`cliente_${client.name.replace(/\s+/g,'_')}.json`; a.click(); URL.revokeObjectURL(url); }
function openImport(){ const input=document.createElement('input'); input.type='file'; input.accept='application/json'; input.onchange=()=>{ const f=input.files[0]; const r=new FileReader(); r.onload=e=>{ try{ const data=JSON.parse(e.target.result); if(data.clients){ DB=data; save(); renderClients(); alert('Importação completa'); } else { // single client
        if(data.id && data.name){ const exists=DB.clients.find(x=>x.id===data.id); if(!exists) DB.clients.push(data); else { if(confirm('Cliente existe. Substituir?')){ DB.clients=DB.clients.map(c=>c.id===data.id?data:c) } } save(); renderClients(); alert('Cliente importado'); }
      } } catch(err){alert('Arquivo inválido')} }; r.readAsText(f)}; input.click(); }

// pdf export client (uses html2canvas + jsPDF)
async function exportClientPDF(clientId){ const client=DB.clients.find(x=>x.id===clientId); if(!client) return; const { jsPDF } = window.jspdf; // build an ephemeral DOM element to capture
  const wrap=document.createElement('div'); wrap.style.padding='14px'; wrap.style.width='700px'; wrap.style.background='#fff'; wrap.innerHTML=`<h2>Ficha - ${escapeHtml(client.name)}</h2><div><strong>Telefone:</strong> ${escapeHtml(client.phone||'')}</div><div><strong>Data Nasc:</strong> ${client.birth||''}</div><div style=\"margin-top:8px\"><strong>Observações:</strong><div>${escapeHtml(client.notes||'')}</div></div>`;
  client.procedures.forEach(p=>{
    const pdiv=document.createElement('div'); pdiv.style.marginTop='10px'; pdiv.innerHTML=`<h3>${escapeHtml(p.procedure)}</h3><div>${p.date} — ${escapeHtml(p.professional||'')}</div><div>${escapeHtml(p.notes||'')}</div>`;
    if(p.before) pdiv.innerHTML+=`<div style=\"margin-top:6px\"><img src=\"${p.before}\" style=\"max-width:100%;height:auto;\"></div>`;
    if(p.after) pdiv.innerHTML+=`<div style=\"margin-top:6px\"><img src=\"${p.after}\" style=\"max-width:100%;height:auto;\"></div>`;
    if(p.signature) pdiv.innerHTML+=`<div style=\"margin-top:6px\"><img src=\"${p.signature}\" style=\"max-width:100%;height:auto;border:1px solid #eee;\"></div>`;
    wrap.appendChild(pdiv);
  });
  document.body.appendChild(wrap); try{ const canvas = await html2canvas(wrap,{scale:1}); const imgData = canvas.toDataURL('image/png'); const pdf = new jsPDF('p','pt','a4'); const imgWidth = 595; const imgHeight = canvas.height * imgWidth / canvas.width; pdf.addImage(imgData,'PNG',0,0,imgWidth,imgHeight); pdf.save('ficha_'+client.name.replace(/\s+/g,'_')+'.pdf'); } catch(err){alert('Erro ao gerar PDF: '+err.message)} finally{ document.body.removeChild(wrap); }}

// export all fichas pdf (simple)
async function exportAllToPDF(){ if(!DB.clients.length) return alert('Sem clientes'); for(const c of DB.clients){ await exportClientPDF(c.id); }
}

// utility: file to base64
function fileToBase64(file){ return new Promise((res,rej)=>{ const r=new FileReader(); r.onload=()=>res(r.result); r.onerror=rej; r.readAsDataURL(file); }) }

// modal helpers
function openModal(html, onSave){ $('modalContent').innerHTML=html; $('modal').style.display='flex'; return new Promise(resolve=>{ $('modalCancel').onclick=()=>{ $('modal').style.display='none'; resolve(null); } $('modalSave').onclick=async ()=>{ const r = await onSave(); $('modal').style.display='none'; resolve(r); } }); }
function openInfoModal(html){ $('modalContent').innerHTML=html; $('modal').style.display='flex'; $('modalSave').style.display='none'; }

// escape html
function escapeHtml(t){ return (t||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

// events
$('btnNewClient').onclick=()=>openClientModal();
$('btnBackup').onclick=()=>downloadJSON();
$('btnImport').onclick=()=>openImport();
$('searchClient').oninput=(e)=>renderClients(e.target.value);
$('btnClearLocal').onclick=()=>{ if(confirm('Apagar todos os dados locais?')){ DB={clients:[]}; save(); renderClients(); $('procedureArea').innerHTML=''; localStorage.removeItem(STORAGE_KEY); }}
$('selectClient').onchange=(e)=>renderProcedureArea(e.target.value);
$('btnNewProcedure').onclick=()=>{ const v=$('selectClient').value; if(!v) return alert('Selecione um cliente primeiro'); openProcedureModal(v); }
$('btnPDFAll').onclick=()=>exportAllToPDF();

// client list click handlers
$('clientList').onclick=(e)=>{ const b=e.target.closest('button'); if(!b) return; const id=b.dataset.id; const act=b.dataset.action; if(act==='open'){ // open client -> select
    $('selectClient').value=id; renderProcedureArea(id); }
  if(act==='export') downloadClientJSON(id);
  if(act==='del'){ if(confirm('Apagar cliente e seus procedimentos?')){ DB.clients=DB.clients.filter(x=>x.id!==id); save(); renderClients(); $('procedureArea').innerHTML=''; } }
}

// PIN (simple)
$('btnPin').onclick=()=>{ const pin=prompt('Defina um PIN numérico (4 dígitos) ou deixe em branco para remover'); if(!pin){ localStorage.removeItem(STORAGE_KEY+'_pin'); alert('PIN removido'); } else if(!/^[0-9]{4}$/.test(pin)) alert('PIN deve ter 4 dígitos'); else { localStorage.setItem(STORAGE_KEY+'_pin',pin); alert('PIN salvo'); } }

// download client

// init seed
function seed(){ if(!DB.clients.length){ const c1={id:uid('c_'),name:'Maria Silva',phone:'(11) 99999-0001',birth:'1990-05-10',notes:'Alergia a ácido',photo:null,procedures:[]}; const c2={id:uid('c_'),name:'João Souza',phone:'(11) 98888-1111',birth:'1985-11-12',notes:'Hipertenso',photo:null,procedures:[]}; DB.clients.push(c1,c2); save(); } }

// load & start
load(); seed(); renderClients();

// On load: check PIN lock
(function checkPin(){ const pin=localStorage.getItem(STORAGE_KEY+'_pin'); if(pin){ const entry = prompt('Digite o PIN para acessar o sistema'); if(entry!==pin){ alert('PIN incorreto — acesso bloqueado'); document.body.innerHTML='<div style="display:flex;align-items:center;justify-content:center;height:100vh"><h2>Acesso bloqueado</h2></div>'; } } })();

console.log('Sistema Ficha Clínica carregado — offline, sem servidor. Use Exportar para backups.');
</script>
</body>
</html>

