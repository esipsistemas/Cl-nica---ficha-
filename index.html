<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Gerador ESIP Profissional</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{background:#2b0000;color:white;font-family:Arial,sans-serif;text-align:center;margin:0;padding:20px;}
.container{max-width:420px;margin:auto;background:#3a0000;padding:20px;border-radius:15px;}
label{display:block;text-align:left;margin-top:15px;}
input,select{width:100%;padding:10px;border-radius:6px;border:none;margin-top:5px;background:#550000;color:white;}
button{padding:10px;background:#ff0000;color:white;border:none;border-radius:8px;cursor:pointer;}
#qrcode{margin-top:20px;}
#loginBox,#adminArea{display:none;background:#1a0000;padding:20px;border-radius:12px;max-width:900px;margin:40px auto;}
table{width:100%;border-collapse:collapse;margin-top:15px;}
th,td{border:1px solid #660000;padding:6px;font-size:14px;}
th{background:#330000;}
.actions button{background:#aa0000;}
.search-box{margin:15px 0;}
.notice{color:#aaffcc;margin-top:8px;}
</style>
</head>

<body>

<h2>ğŸ“¡ ESIP - Gerador de Ingressos</h2>
<button onclick="mostrarLogin()">ğŸ” Ãrea do Administrador</button>

<div class="container">
    <label>Nome</label>
    <input id="nome">

    <label>Evento</label>
    <input id="evento" oninput="this.value=this.value.toUpperCase()">

    <label>Portaria</label>
    <select id="portaria">
        <option value="A">Portaria A</option>
        <option value="B">Portaria B</option>
        <option value="C">Portaria C</option>
    </select>

    <label>CPF</label>
    <input id="cpf" maxlength="11" oninput="this.value=this.value.replace(/\D/g,'')">

    <button onclick="gerarQR()">Gerar QR</button>
    <div id="qrcode"></div>
    <p id="status" class="notice"></p>
</div>

<div id="loginBox">
    <h3>ğŸ” Login do Administrador</h3>
    <input id="senhaAdmin" type="password" placeholder="Senha">
    <button onclick="validarAdmin()">Entrar</button>
    <button onclick="fecharLogin()">Cancelar</button>
</div>

<div id="adminArea">
    <h3>ğŸ“‹ Registros</h3>

    <div class="search-box">
        <input id="buscarCPF" placeholder="Buscar por CPF" oninput="filtrarCPF()">
    </div>

    <table>
        <thead>
            <tr>
                <th>Nome</th>
                <th>Evento</th>
                <th>CPF</th>
                <th>Portaria</th>
                <th>ID</th>
                <th>AÃ§Ã£o</th>
            </tr>
        </thead>
        <tbody id="registrosTabela"></tbody>
    </table>

    <br>
    <button onclick="fecharAdmin()">ğŸ”™ Voltar</button>
</div>

<script>
let ultimoID="";

function _getRegistros(){
    return JSON.parse(localStorage.getItem("esipRegistros")||"[]");
}
function _setRegistros(a){
    localStorage.setItem("esipRegistros",JSON.stringify(a));
}

function gerarQR(){
    if(cpf.value.length!==11){
        alert("CPF invÃ¡lido");
        return;
    }
    ultimoID=portaria.value+"-INGR-"+Math.random().toString(36).substr(2,8).toUpperCase();
    qrcode.innerHTML="";
    new QRCode(qrcode,{text:ultimoID,width:220,height:220});
    let r=_getRegistros();
    r.push({
        nome:nome.value,
        evento:evento.value,
        cpf:cpf.value,
        portaria:portaria.value,
        id:ultimoID
    });
    _setRegistros(r);
    status.textContent="QR gerado: "+ultimoID;
}

function mostrarLogin(){
    loginBox.style.display="block";
}
function fecharLogin(){
    loginBox.style.display="none";
}
function validarAdmin(){
    if(senhaAdmin.value==="ADMIN2025"){
        loginBox.style.display="none";
        adminArea.style.display="block";
        carregarRegistros();
    } else {
        alert("Senha incorreta");
    }
}
function fecharAdmin(){
    adminArea.style.display="none";
}

function carregarRegistros(lista=_getRegistros()){
    registrosTabela.innerHTML="";
    lista.forEach((x,i)=>{
        registrosTabela.innerHTML+=`
        <tr>
            <td>${x.nome}</td>
            <td>${x.evento}</td>
            <td>${x.cpf}</td>
            <td>${x.portaria}</td>
            <td>${x.id}</td>
            <td class="actions">
                <button onclick="excluirRegistro(${i})">ğŸ—‘ï¸</button>
            </td>
        </tr>`;
    });
}

function excluirRegistro(i){
    if(!confirm("Excluir este registro?")) return;
    let r=_getRegistros();
    r.splice(i,1);
    _setRegistros(r);
    carregarRegistros();
}

function filtrarCPF(){
    const termo=buscarCPF.value.trim();
    const filtrados=_getRegistros().filter(x=>x.cpf.includes(termo));
    carregarRegistros(filtrados);
}
</script>

</body>
</html>

