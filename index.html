<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Trena Digital ‚Äì Prot√≥tipo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    margin:0;
    background:#0b0f14;
    color:#e0e0e0;
    font-family:Arial,sans-serif;
    text-align:center;
}
header{
    padding:10px;
    font-weight:bold;
    background:#05080c;
    border-bottom:1px solid #1f2a36;
}
#camera-container{
    position:relative;
    width:100%;
    height:70vh;
    background:black;
}
video{
    width:100%;
    height:100%;
    object-fit:cover;
}
.guide-line{
    position:absolute;
    top:0;
    bottom:0;
    left:50%;
    width:2px;
    background:#00e5ff;
    box-shadow:0 0 10px #00e5ff;
}
.center-point{
    position:absolute;
    top:50%;
    left:50%;
    width:10px;
    height:10px;
    background:#00e5ff;
    border-radius:50%;
    transform:translate(-50%,-50%);
    box-shadow:0 0 12px #00e5ff;
}
.controls{
    padding:15px;
}
button{
    background:#111820;
    color:#00e5ff;
    border:1px solid #00e5ff;
    padding:12px 18px;
    margin:5px;
    font-size:16px;
    border-radius:6px;
}
#result{
    margin-top:10px;
    font-size:22px;
    color:#7ffcff;
}
.measuring{
    color:#00ff88;
    font-weight:bold;
}
footer{
    font-size:12px;
    opacity:0.6;
}
</style>
</head>

<body>

<header>üìè TRENA DIGITAL ‚Äì PROT√ìTIPO</header>

<div id="camera-container">
    <video id="video" playsinline></video>
    <div class="guide-line"></div>
    <div class="center-point"></div>
</div>

<div class="controls">
    <button onclick="startCamera()">‚ñ∂ Iniciar</button>
    <button onclick="startMeasure()">üìê Medir</button>
    <button onclick="endMeasure()">‚ñ† Finalizar</button>
    <div id="result">Aguardando alinhamento‚Ä¶</div>
</div>

<footer>
Prot√≥tipo t√©cnico ‚Ä¢ Fluxo real de medi√ß√£o
</footer>

<script>
let stream = null;
let cameraAtiva = false;
let medindo = false;
let startTime = null;
let interval = null;
let currentMeters = 0;

// Abre SOMENTE a c√¢mera
async function startCamera(){
    if(cameraAtiva) return;

    try{
        stream = await navigator.mediaDevices.getUserMedia({
            video:{ facingMode:"environment" },
            audio:false
        });
        const video = document.getElementById("video");
        video.srcObject = stream;
        await video.play();

        cameraAtiva = true;
        document.getElementById("result").innerText =
            "C√¢mera ativa. Alinhe e toque em MEDIR.";

    }catch{
        alert("Permita o acesso √† c√¢mera");
    }
}

// Inicia a medi√ß√£o (n√∫meros sobem)
function startMeasure(){
    if(!cameraAtiva || medindo) return;

    medindo = true;
    startTime = Date.now();
    currentMeters = 0;

    const result = document.getElementById("result");
    result.classList.add("measuring");

    interval = setInterval(()=>{
        const elapsed = (Date.now() - startTime) / 1000;

        // SIMULA√á√ÉO DE DESLOCAMENTO
        currentMeters = elapsed * 0.5;

        result.innerText = `${currentMeters.toFixed(2)} m`;
    },100);
}

// Finaliza tudo
function endMeasure(){
    if(interval){
        clearInterval(interval);
        interval = null;
    }

    medindo = false;

    const result = document.getElementById("result");
    result.classList.remove("measuring");

    if(currentMeters > 0){
        result.innerText = `Dist√¢ncia final: ${currentMeters.toFixed(2)} m`;
    }else{
        result.innerText = "Medi√ß√£o cancelada";
    }

    if(stream){
        stream.getTracks().forEach(t=>t.stop());
        stream = null;
    }

    cameraAtiva = false;
}
</script>

</body>
</html>

