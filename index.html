<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Trena Digital ‚Äì Prot√≥tipo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    margin:0;
    background:#0b0f14;
    color:#e0e0e0;
    font-family:Arial,sans-serif;
    overflow:hidden;
}

/* HEADER */
header{
    padding:10px;
    font-weight:bold;
    background:#05080c;
    border-bottom:1px solid #1f2a36;
    text-align:center;
}

/* C√ÇMERA */
#camera-container{
    position:relative;
    width:100%;
    height:100vh;
    background:black;
}

video{
    width:100%;
    height:100%;
    object-fit:cover;
    pointer-events:none;
}

/* GUIA AR */
.guide-line{
    position:absolute;
    top:0;
    bottom:0;
    left:50%;
    width:1px;
    background:linear-gradient(transparent,#00e5ff,transparent);
}

.center-point{
    position:absolute;
    top:50%;
    left:50%;
    width:10px;
    height:10px;
    background:#00e5ff;
    border-radius:50%;
    transform:translate(-50%,-50%);
    box-shadow:0 0 12px #00e5ff;
}

.center-point::after{
    content:"";
    position:absolute;
    width:30px;
    height:30px;
    border:2px solid #00e5ff;
    border-radius:50%;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    opacity:0.6;
}

/* HUD RESULTADO */
#result{
    position:absolute;
    bottom:100px;
    left:50%;
    transform:translateX(-50%);
    background:rgba(0,0,0,0.6);
    padding:12px 20px;
    border-radius:30px;
    font-size:22px;
    color:#7ffcff;
    backdrop-filter: blur(6px);
    border:1px solid #1f2a36;
}

/* MEDINDO */
.measuring{
    color:#00ff88;
    animation:pulse 1s infinite;
}

@keyframes pulse{
    0%{ box-shadow:0 0 10px #00ff88; }
    50%{ box-shadow:0 0 25px #00ff88; }
    100%{ box-shadow:0 0 10px #00ff88; }
}

/* DICA */
#hint{
    position:absolute;
    top:10px;
    left:50%;
    transform:translateX(-50%);
    font-size:13px;
    opacity:0.6;
}

/* CONTROLES */
.controls{
    position:fixed;
    bottom:0;
    left:0;
    right:0;
    display:flex;
    justify-content:space-around;
    padding:15px;
    background:rgba(5,8,12,0.9);
    backdrop-filter: blur(10px);
    border-top:1px solid #1f2a36;
}

button{
    background:#111820;
    color:#00e5ff;
    border:1px solid #00e5ff;
    padding:14px 18px;
    font-size:18px;
    border-radius:50%;
    transition:all 0.2s ease;
}

button:active{
    transform:scale(0.9);
}

button.disabled{
    opacity:0.4;
    pointer-events:none;
}
</style>
</head>

<body>

<header>üìè TRENA DIGITAL</header>

<div id="camera-container">
    <video id="video" playsinline></video>
    <div class="guide-line"></div>
    <div class="center-point"></div>
    <div id="hint">Alinhe o alvo e toque em üìê</div>
    <div id="result">Sistema pronto</div>
</div>

<div class="controls">
    <button id="btnStart">üì∑</button>
    <button id="btnMeasure" class="disabled">üìê</button>
    <button id="btnStop">‚ñ†</button>
</div>

<script>
let stream = null;
let interval = null;
let startTime = 0;
let currentMeters = 0;

const video = document.getElementById("video");
const result = document.getElementById("result");

const btnStart = document.getElementById("btnStart");
const btnMeasure = document.getElementById("btnMeasure");
const btnStop = document.getElementById("btnStop");

bind(btnStart, openCamera);
bind(btnMeasure, startMeasure);
bind(btnStop, stopAll);

function bind(el, fn){
    el.addEventListener("touchstart", fn, { passive:true });
    el.addEventListener("click", fn);
}

// ABRIR C√ÇMERA
async function openCamera(){
    if(stream) return;

    try{
        stream = await navigator.mediaDevices.getUserMedia({
            video:{ facingMode:"environment" },
            audio:false
        });

        video.srcObject = stream;
        await video.play();

        btnMeasure.classList.remove("disabled");
        result.innerText = "C√¢mera ativa";

    }catch{
        alert("Permita o acesso √† c√¢mera");
    }
}

// MEDIR
function startMeasure(){
    if(interval) return;

    startTime = Date.now();
    currentMeters = 0;
    result.classList.add("measuring");

    interval = setInterval(()=>{
        const elapsed = (Date.now() - startTime) / 1000;
        currentMeters = elapsed * 0.5;
        result.innerText = `${currentMeters.toFixed(2)} m`;
    },100);
}

// FINALIZAR
function stopAll(){
    if(interval){
        clearInterval(interval);
        interval = null;
    }

    result.classList.remove("measuring");

    if(currentMeters > 0){
        result.innerText = `Dist√¢ncia: ${currentMeters.toFixed(2)} m`;
    }else{
        result.innerText = "Sistema finalizado";
    }

    if(stream){
        stream.getTracks().forEach(t=>t.stop());
        stream = null;
    }

    btnMeasure.classList.add("disabled");
}
</script>

</body>
</html>

